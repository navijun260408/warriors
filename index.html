<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>MP3 プレイヤー</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      background: url('background.png') no-repeat center center fixed;
      background-size: cover;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      max-width: 400px;
      margin: 0 auto;
    }
    .full-width {
      grid-column: span 2;
    }
    button {
      font-size: 18px;
      padding: 14px;
      border: none;
      border-radius: 8px;
      background-color: #ffeb3b; /* 黄色 */
      color: blue;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button.playing {
      background-color: #ff9800; /* 再生中：オレンジ */
    }
    button.queued {
      background-color: #9c27b0; /* 予約済み：パープル */
    }
    #stopButton {
      background-color: #4caf50; /* 緑 */
      color: white;
    }
    #stopButton.active {
      background-color: #b71c1c !important;
    }
  </style>
</head>
<body>
  <div class="grid">
    <button data-file="1st.mp3">1st down</button>
    <button data-file="2nd.mp3">2nd down</button>
    <button data-file="3rd.mp3">3rd down</button>
    <button data-file="pant.mp3">pant</button>
    <button data-file="kickoff.mp3">kickoff</button>
    <button data-file="touchdown.mp3">touchdown</button>

    <button class="full-width" data-file="tequila.mp3">tequila</button>
    <button class="full-width" data-file="fineplay.mp3">fineplay</button>
    <button class="full-width" id="stopButton">STOP</button>
  </div>

  <script>
    const buttons = document.querySelectorAll('button[data-file]');
    const stopButton = document.getElementById('stopButton');

    let currentAudio = null;
    let currentButton = null;
    let queuedTrack = null;

    buttons.forEach(button => {
      const file = button.getAttribute('data-file');
      const audio = new Audio(file);
      const isSpecial = (file === 'fineplay.mp3' || file === 'touchdown.mp3');

      button.addEventListener('click', () => {
        // 再生中に予約処理（fineplay/touchdown）
        if (isSpecial && currentAudio && currentAudio !== audio && !currentAudio.paused && !currentAudio.ended) {
          if (queuedTrack && queuedTrack.file === file) {
            button.classList.remove('queued');
            queuedTrack = null;
            return;
          }
          if (queuedTrack) return; // 既に他が予約されていたら無視

          queuedTrack = { audio, button, file };
          button.classList.add('queued');
          return;
        }

        // 通常再生
        if (!currentAudio || currentAudio.paused || currentAudio.ended) {
          if (currentButton) currentButton.classList.remove('playing');
          button.classList.add('playing');
          audio.play();
          currentAudio = audio;
          currentButton = button;
        }
      });

      audio.addEventListener('ended', () => {
        if (currentButton) currentButton.classList.remove('playing');
        currentAudio = null;
        currentButton = null;

        if (queuedTrack) {
          const { audio: nextAudio, button: nextButton } = queuedTrack;
          nextButton.classList.remove('queued');
          nextButton.classList.add('playing');
          nextAudio.play();
          currentAudio = nextAudio;
          currentButton = nextButton;
          queuedTrack = null;
        }
      });
    });

    stopButton.addEventListener('click', () => {
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
        if (currentButton) currentButton.classList.remove('playing');
        currentAudio = null;
        currentButton = null;
      }
      if (queuedTrack && queuedTrack.button) {
        queuedTrack.button.classList.remove('queued');
      }
      queuedTrack = null;

      stopButton.classList.add('active');
      setTimeout(() => {
        stopButton.classList.remove('active');
      }, 2000);
    });
  </script>
</body>
</html>
